version: '3'

services:
  web:
    container_name: s41-lora-geodata-service
    image: s41-lora-geodata-service:latest
    restart: always
    build: .
    links:
      - postgres:postgres
    ports:
      - 9000:8080
    volumes:
      - web-data:/etc/nginx

  data:
    image: postgres:latest
    volumes:
      - db-data:/var/lib/postgresql/data
    command: "true"

  postgres:
    restart: always
    image: postgres:latest
    volumes:
      - db-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  nginx:
    restart: always
    image: nginx:1.18.0-alpine
    # build: ./nginx
    ports:
      - "80:80"
    volumes:
      - web-data:/usr/src/app/static
      - web-data:/etc/nginx
    links:
      - web:web


volumes:
  db-data:
  web-data:

    # env_file: 
    #   - .env
    # command: /usr/local/bin/gunicorn -w 2 -b :8000 app:app

#   s41-lora-geodata-service:
#     container_name: s41-lora-geodata-service
#     build: .
#     image: s41-lora-geodata-service:latest
#     depends_on:
#       - db
#     ports:
#       - 9000:8080
#     volumes:
#       - nginx:/etc/nginx


  # nginx:
  #   restart: always
  #   build: ./nginx
  #   ports:
  #     - "80:80"
  #   volumes:
  #     - .:/www/static
  #     - web-data:/usr/src/app/static
  #   links:
  #     - web:web

  # data:
  #   image: postgres:latest
  #   volumes:
  #     - db-data:/var/lib/postgresql/data
  #   command: "true"

  # postgres:
  #   restart: always
  #   image: postgres:latest
  #   volumes:
  #     - db-data:/var/lib/postgresql/data
  #   ports:
  #     - "5432:5432"



# version: '3'
# services:
#   s41-lora-geodata-service:
#     container_name: s41-lora-geodata-service
#     build: .
#     image: s41-lora-geodata-service:latest
#     depends_on:
#       - db
#     ports:
#       - 9000:8080
#     volumes:
#       - nginx:/etc/nginx

#   db:
#     container_name: db
#     image: postgres:latest
#     restart: always
#     ports:
#       - 5432:5432
#     environment:
#       - POSTGRES_DB=postgres
#       - POSTGRES_USER=postgres
#       - POSTGRES_PASSWORD=mattmatt
#     networks:
#       - app_layer

#   nginx:
#     container_name: nginx
#     image: nginx:1.18.0-alpine
#     ports:
#       - 80:80
#     volumes:
#       - nginx:/etc/nginx
#     networks:
#       - app_layer

# networks:
#   app_layer: {}
#   # driver: net1
#   # config:
#         # - subnet: 172.16.100.0/24
# #     db_layer:
# #       driver: bridge
# #       config:
# #         - subnet: 172.16.100.0/24

# # networks:
# #    example:
# #     external: true

# volumes:
#   nginx: